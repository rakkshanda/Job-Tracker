<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobTracker - Supabase Dashboard</title>
    <link rel="icon" type="image/png" href="icon16.png">
    <link rel="stylesheet" href="dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Google Charts for Sankey Diagram -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-brand">
            <div class="logo">
                <i class="fas fa-heart" style="color: #ff6b9d;"></i>
                <span id="live-datetime">Loading...</span>
            </div>
        </div>
        <div class="nav-actions">
            <button class="insights-toggle-btn" id="insights-toggle-btn" title="Show Insights">
                <i class="fas fa-chart-bar"></i>
                <span>Show Insights</span>
            </button>
            <button class="sankey-toggle-btn" id="sankey-toggle-btn" title="Show Sankey diagram">
                <i class="fas fa-chart-line"></i>
                <span>Show Sankey</span>
            </button>
            <button class="theme-toggle" id="theme-toggle" title="Toggle dark mode">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container" id="main-container">
        <!-- Header Section -->
        <div class="header-section">
            <div class="action-buttons">
                <!-- <button class="action-btn import-btn" id="import-csv-btn">
                    <i class="fas fa-upload"></i>
                    Import CSV
                </button> -->
                <button class="action-btn delete-selected-btn" id="delete-selected-btn" style="display: none;">
                    <i class="fas fa-trash-alt"></i>
                    Delete Selected (<span id="selected-count">0</span>)
                </button>
            </div>
        </div>

        <!-- Insights Section -->
        <div class="insights-section" id="insights-section" style="display: none;">
            <h2 class="insights-title">Insights</h2>
            
            <div class="insights-grid">
                <!-- Performance Metrics -->
                <div class="insights-category">
                    <h3 class="category-title">Performance Metrics</h3>
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Ghost Rate</div>
                            <div class="metric-value ghost-rate" id="ghost-rate">0%</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Response Time</div>
                            <div class="metric-value" id="response-time">0 days</div>
                        </div>
                    </div>
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Longest Waiting Application</div>
                            <div class="metric-value" id="longest-waiting">0 days</div>
                        </div>
                    </div>
                </div>

                <!-- Volume Metrics -->
                <div class="insights-category">
                    <h3 class="category-title">Volume Metrics</h3>
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Total Applications</div>
                            <div class="metric-value teal" id="total-apps-insight">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Most Active Day</div>
                            <div class="metric-value" id="most-active-day">
                                <span class="day-name">-</span>
                                <span class="day-count">0 apps</span>
                            </div>
                        </div>
                    </div>
                    <div class="metrics-row">
                        <div class="metric-card full-width">
                            <div class="metric-label">Application Rate</div>
                            <div class="metric-value-group">
                                <div class="rate-item">
                                    <span class="rate-value" id="rate-daily">0</span>
                                    <span class="rate-unit">/day</span>
                                </div>
                                <div class="rate-item">
                                    <span class="rate-value" id="rate-weekly">0</span>
                                    <span class="rate-unit">/wk</span>
                                </div>
                                <div class="rate-item">
                                    <span class="rate-value" id="rate-monthly">0</span>
                                    <span class="rate-unit">/mo</span>
                                </div>
                                <div class="rate-item">
                                    <span class="rate-value" id="rate-yearly">0</span>
                                    <span class="rate-unit">/yr</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Conversion Funnel -->
                <div class="insights-category">
                    <h3 class="category-title">Conversion Funnel</h3>
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Applied → Screening</div>
                            <div class="metric-value conversion" id="conv-screening">0%</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Screening → Interview</div>
                            <div class="metric-value conversion" id="conv-interview">0%</div>
                        </div>
                    </div>
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Interview → Offer</div>
                            <div class="metric-value conversion" id="conv-offer">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Summary Cards -->
        <div class="activity-summary" id="activity-summary">
            <!-- This Month Card -->
            <div class="activity-card">
                <div class="activity-header">
                    <select class="month-selector" id="month-selector">
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
                <div class="activity-total" id="month-total">0 applications</div>
                <div class="activity-weeks">
                    <div class="week-item">
                        <div class="week-label">Week 1</div>
                        <div class="week-count" id="week-1">0</div>
                    </div>
                    <div class="week-item">
                        <div class="week-label">Week 2</div>
                        <div class="week-count" id="week-2">0</div>
                    </div>
                    <div class="week-item">
                        <div class="week-label">Week 3</div>
                        <div class="week-count" id="week-3">0</div>
                    </div>
                    <div class="week-item">
                        <div class="week-label">Week 4</div>
                        <div class="week-count" id="week-4">0</div>
                    </div>
                    <div class="week-item">
                        <div class="week-label">Week 5</div>
                        <div class="week-count" id="week-5">0</div>
                    </div>
                </div>
            </div>

            <!-- This Week Card -->
            <div class="activity-card">
                <h3 class="activity-title">This Week <span class="week-range" id="week-range"></span></h3>
                <div class="activity-total" id="week-total">0 applications</div>
                <div class="activity-days">
                    <div class="day-item">
                        <div class="day-label">Mon</div>
                        <div class="day-count" id="day-mon">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Tue</div>
                        <div class="day-count" id="day-tue">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Wed</div>
                        <div class="day-count" id="day-wed">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Thu</div>
                        <div class="day-count" id="day-thu">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Fri</div>
                        <div class="day-count" id="day-fri">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Sat</div>
                        <div class="day-count" id="day-sat">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Sun</div>
                        <div class="day-count" id="day-sun">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-briefcase"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="total-applications">0</div>
                    <div class="stat-label">Total Applications</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-building"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="total-companies">0</div>
                    <div class="stat-label">Companies</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="total-locations">0</div>
                    <div class="stat-label">Locations</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-fire"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="current-streak">0</div>
                    <div class="stat-label">Days Current Streak</div>
                </div>
            </div>
        </div>

        <!-- Jobs Table -->
        <div class="jobs-section table-section">
            <div class="table-header">
                <!-- Search Bar -->
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="search-input" class="search-input" placeholder="Search jobs by company, position...">
                </div>
                
                <!-- Filter Buttons -->
                <div class="filter-buttons">
                        <button class="clear-filters-btn" id="clear-filters-btn" title="Clear all filters" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="filter-group">
                            <button class="filter-btn" data-filter="date">
                                <i class="fas fa-calendar"></i>
                                <span class="filter-value">All Time</span>
                            </button>
                            <div class="filter-dropdown">
                                <div class="filter-option" data-value="all">All Time</div>
                                <div class="filter-option" data-value="today">Today</div>
                                <div class="filter-option" data-value="week">This Week</div>
                                <div class="filter-option" data-value="month">This Month</div>
                                <div class="filter-option" data-value="3months">Last 3 Months</div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <button class="filter-btn" data-filter="status">
                                <i class="fas fa-filter"></i>
                                <span class="filter-value">Status</span>
                            </button>
                            <div class="filter-dropdown">
                                <div class="filter-option" data-value="all">All Status</div>
                                <div class="filter-option" data-value="saved">Saved</div>
                                <div class="filter-option" data-value="applied">Applied</div>
                                <div class="filter-option" data-value="resume_screening">Resume Screening</div>
                                <div class="filter-option" data-value="interview">Interview</div>
                                <div class="filter-option" data-value="offer">Offer</div>
                                <div class="filter-option" data-value="rejected">Rejected</div>
                                <div class="filter-option" data-value="withdrawn">Withdrawn</div>
                                <div class="filter-option" data-value="ended">Ended</div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <button class="filter-btn" data-filter="company">
                                <i class="fas fa-building"></i>
                                <span class="filter-value">All Companies</span>
                            </button>
                            <div class="filter-dropdown">
                                <div class="filter-option" data-value="all">All Companies</div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <button class="filter-btn" data-filter="location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span class="filter-value">All Locations</span>
                            </button>
                            <div class="filter-dropdown">
                                <div class="filter-option" data-value="all">All Locations</div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <button class="filter-btn" data-filter="source">
                                <i class="fas fa-globe"></i>
                                <span class="filter-value">All Sources</span>
                            </button>
                            <div class="filter-dropdown">
                                <div class="filter-option" data-value="all">All Sources</div>
                            </div>
                        </div>
                        <button class="refresh-icon-btn" id="refresh-btn" title="Refresh Data">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="jobs-table">
                    <thead>
                        <tr>
                            <th class="col-select" style="width: 40px;">
                                <input type="checkbox" id="select-all-checkbox" title="Select/Deselect All">
                            </th>
                            <th class="col-date">Applied Date</th>
                            <th class="col-company">Company</th>
                            <th class="col-title">Title</th>
                            <th class="col-location">Location</th>
                            <th class="col-status">Status</th>
                            <th class="col-source">Source</th>
                            <th class="col-url">URL</th>
                            <th class="col-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="jobs-container">
                        <!-- Jobs will be rendered here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="pagination-container" id="pagination-container"></div>
        </div>
    </div>

    <!-- Sankey Diagram View -->
    <div class="sankey-container" id="sankey-container" style="display: none;">
   
        <!-- Sankey Filters -->
        <div class="sankey-filters">
            <div class="filter-group">
                <label for="sankey-date-from">From Date:</label>
                <input type="date" id="sankey-date-from" class="date-input">
            </div>
            <div class="filter-group">
                <label for="sankey-date-to">To Date:</label>
                <input type="date" id="sankey-date-to" class="date-input">
            </div>
            <div class="filter-group">
                <label>Status Filter:</label>
                <div class="status-checkboxes" id="sankey-status-filter">
                    <label class="checkbox-label">
                        <input type="checkbox" value="saved" checked> Saved
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="applied" checked> Applied
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="resume_screening" checked> Resume Screening
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="interview" checked> Interview
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="offer" checked> Offer
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="rejected" checked> Rejected
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="withdrawn" checked> Withdrawn
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="ended" checked> Ended
                    </label>
                </div>
            </div>
            <button class="refresh-sankey-btn" id="refresh-sankey-btn" title="Refresh Sankey Data">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>

        <!-- Sankey Chart -->
        <div class="sankey-chart-container">
            <div id="sankey-chart"></div>
        </div>
    </div>

    <!-- Add Job Modal -->
    <div class="modal" id="add-job-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Job Application</h2>
                <button class="close-btn" id="close-add-modal">&times;</button>
            </div>
            <form id="add-job-form">
                <div class="form-group">
                    <label for="job-title">Job Title *</label>
                    <input type="text" id="job-title" required>
                </div>
                <div class="form-group">
                    <label for="job-company">Company *</label>
                    <input type="text" id="job-company" required>
                </div>
                <div class="form-group">
                    <label for="job-location">Location</label>
                    <input type="text" id="job-location">
                </div>
                <div class="form-group">
                    <label for="job-url">Job URL <span style="color: #94a3b8; font-size: 0.85rem;">(optional)</span></label>
                    <input type="text" id="job-url">
                </div>
                <div class="form-group">
                    <label for="job-description">Description</label>
                    <textarea id="job-description" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="job-notes">Notes</label>
                    <textarea id="job-notes" rows="3" placeholder="Add any additional notes about this job..."></textarea>
                </div>
                <div class="form-group">
                    <label for="job-status">Status</label>
                    <select id="job-status">
                        <option value="saved">Saved</option>
                        <option value="applied">Applied</option>
                        <option value="resume_screening">Resume Screening</option>
                        <option value="interview">Interview</option>
                        <option value="offer">Offer</option>
                        <option value="rejected">Rejected</option>
                        <option value="withdrawn">Withdrawn</option>
                        <option value="ended">Ended</option>
                    </select>
                </div>
                <div class="status-history-section" id="status-history-section" style="display: none;">
                    <label>Status Change History <span style="font-size: 0.75rem; color: var(--text-muted); font-weight: normal;">(Drag to reorder)</span></label>
                    
                    <!-- Add New Status Change -->
                    <div class="add-status-change" style="display: flex; gap: 0.75rem; margin-bottom: 1rem; align-items: flex-end;">
                        <div style="flex: 1;">
                            <label style="font-size: 0.85rem; margin-bottom: 0.25rem; display: block;">Status:</label>
                            <select id="new-status-select" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 6px; background: var(--input-bg); color: var(--text-primary);">
                                <option value="saved">Saved</option>
                                <option value="applied">Applied</option>
                                <option value="resume_screening">Resume Screening</option>
                                <option value="interview">Interview</option>
                                <option value="offer">Offer</option>
                                <option value="rejected">Rejected</option>
                                <option value="withdrawn">Withdrawn</option>
                                <option value="ended">Ended</option>
                            </select>
                        </div>
                        <div style="flex: 1;">
                            <label style="font-size: 0.85rem; margin-bottom: 0.25rem; display: block;">Date & Time:</label>
                            <input type="datetime-local" id="new-status-date" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 6px; background: var(--input-bg); color: var(--text-primary);">
                        </div>
                        <button type="button" id="add-status-btn" style="padding: 0.5rem 1rem; background: #6366f1; color: white; border: none; border-radius: 6px; cursor: pointer; white-space: nowrap; font-weight: 500;">
                            <i class="fas fa-plus"></i> Add Status
                        </button>
                    </div>
                    
                    <div class="status-history-list" id="status-history-list">
                        <!-- History items will be dynamically added here -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancel-add-job">Cancel</button>
                    <button type="submit" class="btn-primary">Save Job</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Comment Modal -->
    <div class="modal" id="comment-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Comment</h2>
                <button class="close-btn" id="close-comment-modal">&times;</button>
            </div>
            <form id="comment-form">
                <div class="form-group">
                    <label for="comment-text">Comment</label>
                    <textarea id="comment-text" rows="4" placeholder="Add your notes about this application..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancel-comment">Cancel</button>
                    <button type="submit" class="btn-primary">Save Comment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal" id="import-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Import Jobs from CSV</h2>
                <button class="close-btn" id="close-import-modal">&times;</button>
            </div>
            <div class="import-content">
                <div class="file-upload-area" id="file-upload-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Click to upload CSV file</p>
                    <input type="file" id="csv-file" accept=".csv" style="display: none;">
                </div>
                <div class="import-info">
                    <h4>CSV Format:</h4>
                    <p>Title, Company, Location, Applied Date, Status, URL, Description, Notes</p>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancel-import">Cancel</button>
                    <button type="button" class="btn-primary" id="import-btn" disabled>Import Jobs</button>
                </div>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>
