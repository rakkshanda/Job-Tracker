<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobTracker - Supabase Dashboard</title>
    <link rel="icon" type="image/png" href="icon16.png">
    <link rel="stylesheet" href="dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Optional user config (defines ENV_SUPABASE_URL/KEY if present) -->
    <script src="config.js"></script>
    <!-- Google Charts for Sankey Diagram -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Chart.js for Pie Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-brand">
            <div class="logo">
                <i class="fas fa-heart" style="color: #ff6b9d;"></i>
                <span id="live-datetime">Loading...</span>
            </div>
        </div>
        <div class="nav-actions">
            <!--
            <button class="pomodoro-toggle-btn" id="pomodoro-toggle-btn" title="Show Pomodoro Timer">
                <i class="fas fa-clock"></i>
                <span>Pomodoro</span>
            </button>
            -->
            <button class="tasks-toggle-btn" id="tasks-toggle-btn" title="Show Tasks">
                <i class="fas fa-list-check"></i>
                <span>Tasks</span>
            </button>
            <button class="insights-toggle-btn" id="insights-toggle-btn" title="Show Insights">
                <i class="fas fa-chart-bar"></i>
                <span>Insights</span>
            </button>
            <button class="sankey-toggle-btn" id="sankey-toggle-btn" title="Show Sankey diagram">
                <i class="fas fa-chart-line"></i>
                <span>Sankey</span>
            </button>
            <button class="theme-toggle" id="theme-toggle" title="Toggle dark mode">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container" id="main-container">
        <!-- Header Section -->
        <div class="header-section">
            <div class="action-buttons">
                <!-- Download Backup removed from header; available in Insights only -->
                <button class="action-btn delete-selected-btn" id="delete-selected-btn" style="display: none;">
                    <i class="fas fa-trash-alt"></i>
                    Delete Selected (<span id="selected-count">0</span>)
                </button>
            </div>
        </div>

        <!-- Tasks Section -->
        <div class="tasks-section" id="tasks-section" style="display: none;">
            <h2 class="tasks-title">Tasks</h2>
            <div class="tasks-container">
                <div class="task-input-row">
                    <input type="text" id="new-task-input" placeholder="Add a task and press Enter" />
                    <button id="add-task-btn" class="btn-primary"><i class="fas fa-plus"></i> Add</button>
                </div>
                <ul id="tasks-list" class="tasks-list"></ul>
                <div class="task-actions">
                    <button id="clear-completed-btn" class="btn-secondary">Clear Completed</button>
                    <button id="clear-all-btn" class="btn-secondary">Clear All</button>
                    <button id="clear-storage-btn" class="btn-secondary" title="Remove saved tasks from this browser">Clear Local</button>
                </div>
            </div>
        </div>

        <!-- Pomodoro Section -->
        <div class="pomodoro-section" id="pomodoro-section" style="display: none;">
            <h2 class="pomodoro-title">Pomodoro Timer</h2>

            <div class="pomodoro-container">
                <!-- Timer Setup -->
                <div class="timer-setup" id="timer-setup">
                    <div class="timer-select-group" id="duration-group">
                        <label for="timer-duration">Select Duration:</label>
                        <select id="timer-duration" class="timer-duration-select">
                            <option value="0.5">30 seconds</option>
                            <option value="10">10 minutes</option>
                            <option value="15">15 minutes</option>
                            <option value="30" selected>30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">60 minutes</option>
                            <option value="90">90 minutes</option>
                        </select>
                    </div>
                    <div class="timer-select-group" style="width: 100%; max-width: 400px; display:none;" id="category-group">
                        <label for="focus-category">Category:</label>
                        <div class="category-tabs" id="category-tabs">
                            <button type="button" class="category-tab active" data-category="job-app">
                                <i class="fas fa-briefcase"></i> Job App
                            </button>
                            <button type="button" class="category-tab" data-category="portfolio">
                                <i class="fas fa-folder"></i> Portfolio
                            </button>
                            <button type="button" class="category-tab" data-category="projects">
                                <i class="fas fa-code"></i> Projects
                            </button>
                            <button type="button" class="category-tab" data-category="networking">
                                <i class="fas fa-users"></i> Networking
                            </button>
                        </div>
                    </div>
                    <div class="timer-select-group" style="width: 100%; max-width: 400px; display:none;" id="focus-note-group">
                        <label for="focus-note">What did you focus on?</label>
                        <textarea id="focus-note" class="focus-note-input" placeholder="e.g., Applied to 5 SDE positions, updated resume skills section..." rows="3"></textarea>
                    </div>
                    <button class="start-timer-btn" id="start-timer-btn">
                        <i class="fas fa-play"></i>
                        Start Timer
                    </button>
                </div>

                <!-- Timer Display -->
                <div class="timer-display" id="timer-display" style="display: none;">
                    <!-- Circular Progress Timer -->
                    <div class="circular-timer">
                        <svg class="timer-svg" width="300" height="300">
                            <circle class="timer-circle-bg" cx="150" cy="150" r="130"></circle>
                            <circle class="timer-circle-progress" cx="150" cy="150" r="130" id="timer-progress-circle"></circle>
                        </svg>
                        <div class="timer-text">
                            <div class="timer-time" id="timer-time">00:00</div>
                            <div class="timer-label" id="timer-label">Focus Time</div>
                        </div>
                    </div>

                    <button class="stop-timer-btn" id="stop-timer-btn">
                        <i class="fas fa-stop"></i>
                        Cancel Timer
                    </button>
                </div>

                <!-- Insights & Sessions Layout -->
                <div class="pomodoro-insights">
                    <div class="pomodoro-days" id="pomodoro-days"></div>
                    <div class="pomodoro-analytics">
                        <div class="today-sessions">
                            <h3>Today's Sessions</h3>
                            <div class="sessions-summary" id="sessions-summary">
                                <div class="session-stat">
                                    <i class="fas fa-check-circle"></i>
                                    <span id="sessions-count">0</span> sessions
                                </div>
                                <div class="session-stat">
                                    <i class="fas fa-clock"></i>
                                    <span id="sessions-total-time">0</span> minutes
                                </div>
                            </div>
                            <div class="sessions-list" id="sessions-list"></div>
                        </div>

                        <div class="category-breakdown">
                            <h3>Category Breakdown</h3>
                            <div id="pomodoro-category-pie" class="category-pie"></div>
                        </div>
                    </div>
</div>
</div>
</div>

        <!-- Delete Job Modal -->
        <div class="modal" id="delete-job-modal" style="display: none;">
            <div class="modal-content" style="max-width: 420px;">
                <button class="close-btn" id="close-delete-job-modal">&times;</button>
                <h3 style="margin-top:0;">Delete Job</h3>
                <p style="margin: 0 0 1rem; color: #666;">Are you sure you want to delete this job?</p>
                <div class="modal-actions" style="display:flex; gap: 0.5rem; justify-content:flex-end;">
                    <button type="button" class="btn-secondary" id="cancel-delete-job">Cancel</button>
                    <button type="button" class="btn-primary" id="confirm-delete-job" style="background:#ef4444;">Delete</button>
                </div>
            </div>
        </div>

        <!-- Insights Section -->
        <div class="insights-section" id="insights-section" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 class="insights-title" style="margin: 0;">Insights</h2>
                <button class="action-btn download-csv-btn" id="download-csv-btn-insights">
                    <i class="fas fa-download"></i>
                    Download Backup (CSV)
                </button>
            </div>

            <!-- Pie Charts Section -->
            <div class="pie-charts-section">
                <div class="pie-chart-card">
                    <h3 class="chart-title">Job Type</h3>
                    <div class="chart-container">
                        <canvas id="job-type-chart"></canvas>
                    </div>
                </div>
                <div class="pie-chart-card">
                    <h3 class="chart-title">Locations</h3>
                    <div class="chart-container">
                        <canvas id="locations-chart"></canvas>
                    </div>
                </div>
                <div class="pie-chart-card">
                    <h3 class="chart-title">Top Companies (3+)</h3>
                    <div class="chart-container">
                        <canvas id="companies-chart"></canvas>
                    </div>
                </div>
                <div class="pie-chart-card">
                    <h3 class="chart-title">Sources</h3>
                    <div class="chart-container">
                        <canvas id="sources-chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="insights-grid">
                <!-- Performance Metrics -->
                <div class="insights-category">
                    <h3 class="category-title">Performance Metrics</h3>
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Ghost Rate</div>
                            <div class="metric-value ghost-rate" id="ghost-rate">0%</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Response Time</div>
                            <div class="metric-value" id="response-time">0 days</div>
                        </div>
                    </div>
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Longest Waiting Application</div>
                            <div class="metric-value" id="longest-waiting">0 days</div>
                        </div>
                    </div>
                </div>

                <!-- Volume Metrics -->
                <div class="insights-category">
                    <h3 class="category-title">Volume Metrics</h3>
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Total Applications</div>
                            <div class="metric-value teal" id="total-apps-insight">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Most Active Day</div>
                            <div class="metric-value" id="most-active-day">
                                <span class="day-name">-</span>
                                <span class="day-count">0 apps</span>
                            </div>
                        </div>
                    </div>
                    <div class="metrics-row">
                        <div class="metric-card full-width">
                            <div class="metric-label">Application Rate</div>
                            <div class="metric-value-group">
                                <div class="rate-item">
                                    <span class="rate-value" id="rate-daily">0</span>
                                    <span class="rate-unit">/day</span>
                                </div>
                                <div class="rate-item">
                                    <span class="rate-value" id="rate-weekly">0</span>
                                    <span class="rate-unit">/wk</span>
                                </div>
                                <div class="rate-item">
                                    <span class="rate-value" id="rate-monthly">0</span>
                                    <span class="rate-unit">/mo</span>
                                </div>
                                <div class="rate-item">
                                    <span class="rate-value" id="rate-yearly">0</span>
                                    <span class="rate-unit">/yr</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Conversion Funnel -->
                <div class="insights-category">
                    <h3 class="category-title">Conversion Funnel</h3>
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Applied → Screening</div>
                            <div class="metric-value conversion" id="conv-screening">0%</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Screening → Interview</div>
                            <div class="metric-value conversion" id="conv-interview">0%</div>
                        </div>
                    </div>
                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-label">Interview → Offer</div>
                            <div class="metric-value conversion" id="conv-offer">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Summary Cards -->
        <div class="activity-summary" id="activity-summary">
            <!-- This Month Card -->
            <div class="activity-card">
                <div class="activity-header">
                    <select class="month-selector" id="month-selector">
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
                <div class="activity-total" id="month-total">0 applications</div>
                <div class="activity-weeks">
                    <div class="week-item">
                        <div class="week-label">Week 1</div>
                        <div class="week-count" id="week-1">0</div>
                    </div>
                    <div class="week-item">
                        <div class="week-label">Week 2</div>
                        <div class="week-count" id="week-2">0</div>
                    </div>
                    <div class="week-item">
                        <div class="week-label">Week 3</div>
                        <div class="week-count" id="week-3">0</div>
                    </div>
                    <div class="week-item">
                        <div class="week-label">Week 4</div>
                        <div class="week-count" id="week-4">0</div>
                    </div>
                    <div class="week-item">
                        <div class="week-label">Week 5</div>
                        <div class="week-count" id="week-5">0</div>
                    </div>
                </div>
            </div>

            <!-- This Week Card -->
            <div class="activity-card">
                <h3 class="activity-title">This Week <span class="week-range" id="week-range"></span></h3>
                <div class="activity-total" id="week-total">0 applications</div>
                <div class="activity-days">
                    <div class="day-item">
                        <div class="day-label">Mon</div>
                        <div class="day-count" id="day-mon">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Tue</div>
                        <div class="day-count" id="day-tue">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Wed</div>
                        <div class="day-count" id="day-wed">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Thu</div>
                        <div class="day-count" id="day-thu">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Fri</div>
                        <div class="day-count" id="day-fri">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Sat</div>
                        <div class="day-count" id="day-sat">0</div>
                    </div>
                    <div class="day-item">
                        <div class="day-label">Sun</div>
                        <div class="day-count" id="day-sun">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-section">
            <!-- Countdown card placed alongside stats -->
            <div class="stat-card" id="countdown-card">
                <div class="stat-icon">
                    <i class="fas fa-hourglass-half"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="countdown-text">…</div>
                    <div class="stat-label" id="countdown-subtext" style="font-size: 0.8rem; opacity: 0.8;">days to go</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-briefcase"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="total-applications">0</div>
                    <div class="stat-label">Total Applications</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-building"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="total-companies">0</div>
                    <div class="stat-label">Companies</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="total-locations">0</div>
                    <div class="stat-label">Locations</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-fire"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="current-streak">0</div>
                    <div class="stat-label">Days Current Streak</div>
                    <div class="stat-sublabel" id="highest-streak-label" style="font-size: 0.75rem; color: #666; margin-top: 2px;">
                        Best: <span id="highest-streak">0</span> days
                    </div>
                </div>
            </div>
        </div>

        <!-- Jobs Table -->
        <div class="jobs-section table-section">
            <div class="table-header">
                <!-- Search Bar -->
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="search-input" class="search-input" placeholder="Search jobs by company, position...">
                </div>
                
                <!-- Filter Buttons -->
                <div class="filter-buttons">
                        <button class="clear-filters-btn" id="clear-filters-btn" title="Clear all filters" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="filter-group">
                            <button class="filter-btn" data-filter="date">
                                <i class="fas fa-calendar"></i>
                                <span class="filter-value">All Time</span>
                            </button>
                            <div class="filter-dropdown">
                                <div class="filter-option" data-value="all">All Time</div>
                                <div class="filter-option" data-value="today">Today</div>
                                <div class="filter-option" data-value="week">This Week</div>
                                <div class="filter-option" data-value="month">This Month</div>
                                <div class="filter-option" data-value="3months">Last 3 Months</div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <button class="filter-btn" data-filter="status">
                                <i class="fas fa-filter"></i>
                                <span class="filter-value">Status</span>
                            </button>
                            <div class="filter-dropdown status-dropdown" data-multiselect="status">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                        <div class="filter-group">
                            <button class="filter-btn" data-filter="company">
                                <i class="fas fa-building"></i>
                                <span class="filter-value">All Companies</span>
                            </button>
                            <div class="filter-dropdown company-dropdown" data-multiselect="company">
                                <div class="filter-option" data-value="all">All Companies</div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <button class="filter-btn" data-filter="location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span class="filter-value">All Locations</span>
                            </button>
                            <div class="filter-dropdown">
                                <div class="filter-option" data-value="all">All Locations</div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <button class="filter-btn" data-filter="source">
                                <i class="fas fa-globe"></i>
                                <span class="filter-value">All Sources</span>
                            </button>
                            <div class="filter-dropdown">
                                <div class="filter-option" data-value="all">All Sources</div>
                            </div>
                        </div>
                        <button class="refresh-icon-btn" id="refresh-btn" title="Refresh Data">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="jobs-table">
                    <thead>
                        <tr>
                            <th class="col-select" style="width: 40px;">
                                <input type="checkbox" id="select-all-checkbox" title="Select/Deselect All">
                            </th>
                            <th class="col-date">Applied Date</th>
                            <th class="col-company">Company</th>
                            <th class="col-title">Title</th>
                            <th class="col-location">Location</th>
                            <th class="col-status">Status</th>
                            <th class="col-source">Source</th>
                            <th class="col-url">URL</th>
                            <th class="col-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="jobs-container">
                        <!-- Jobs will be rendered here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="pagination-container" id="pagination-container"></div>
        </div>
    </div>

    <!-- Sankey Diagram View -->
    <div class="sankey-container" id="sankey-container" style="display: none;">
   
        <!-- Sankey Filters -->
        <div class="sankey-filters">
            <div class="filter-group">
                <label for="sankey-date-from">From Date:</label>
                <input type="date" id="sankey-date-from" class="date-input">
            </div>
            <div class="filter-group">
                <label for="sankey-date-to">To Date:</label>
                <input type="date" id="sankey-date-to" class="date-input">
            </div>
            <div class="filter-group">
                <label>Status Filter:</label>
                <div class="status-checkboxes" id="sankey-status-filter">
                    <label class="checkbox-label">
                        <input type="checkbox" value="saved" checked> Saved
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="applied" checked> Applied
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="resume_screening" checked> Resume Screening
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="interview" checked> Interview
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="offer" checked> Offer
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="rejected" checked> Rejected
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="withdrawn" checked> Withdrawn
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" value="ended" checked> Ended
                    </label>
                </div>
            </div>
            <button class="refresh-sankey-btn" id="refresh-sankey-btn" title="Refresh Sankey Data">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>

        <!-- Sankey Chart -->
    <div class="sankey-chart-container">
        <div id="sankey-chart"></div>
    </div>
</div>

    <!-- Delete Session Confirmation Modal -->
    <div class="modal" id="delete-session-modal" style="display: none;">
        <div class="modal-content" style="max-width: 440px;">
            <div class="modal-header">
                <h3>Delete Session</h3>
                <button class="close-btn" id="close-delete-session-modal">&times;</button>
            </div>
            <div class="modal-body" style="padding: 1rem 1.5rem;">
                <p>Are you sure you want to delete this Pomodoro session? This cannot be undone.</p>
            </div>
            <div class="modal-actions" style="display: flex; gap: 0.75rem; justify-content: flex-end; padding: 0 1.5rem 1.25rem;">
                <button class="action-btn" id="cancel-delete-session-btn" style="background: var(--hover-bg); color: var(--text-primary);">Cancel</button>
                <button class="action-btn" id="confirm-delete-session-btn" style="background: #ef4444; color: white;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Add Job Modal -->
    <div class="modal" id="add-job-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Job Application</h2>
                <button class="close-btn" id="close-add-modal">&times;</button>
            </div>
            <form id="add-job-form">
                <div class="form-group">
                    <label for="job-title">Job Title *</label>
                    <input type="text" id="job-title" required>
                </div>
                <div class="form-group">
                    <label for="job-company">Company *</label>
                    <input type="text" id="job-company" required>
                </div>
                <div class="form-group">
                    <label for="job-location">Location</label>
                    <input type="text" id="job-location">
                </div>
                <div class="form-group">
                    <label for="job-url">Job URL <span style="color: #94a3b8; font-size: 0.85rem;">(optional)</span></label>
                    <input type="text" id="job-url">
                </div>
                <div class="form-group">
                    <label for="job-description">Description</label>
                    <textarea id="job-description" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="job-notes">Notes</label>
                    <textarea id="job-notes" rows="3" placeholder="Add any additional notes about this job..."></textarea>
                </div>
                <div class="form-group">
                    <label for="job-external-id">Job ID</label>
                    <input type="text" id="job-external-id" placeholder="e.g., R12345" />
                </div>
                <div class="form-group">
                    <label for="job-status">Status</label>
                    <select id="job-status">
                        <option value="saved">Saved</option>
                        <option value="applied">Applied</option>
                        <option value="resume_screening">Resume Screening</option>
                        <option value="interview">Interview</option>
                        <option value="offer">Offer</option>
                        <option value="rejected">Rejected</option>
                        <option value="withdrawn">Withdrawn</option>
                        <option value="ended">Ended</option>
                    </select>
                </div>
                <div class="status-history-section" id="status-history-section" style="display: none;">
                    <label>Status Change History <span style="font-size: 0.75rem; color: var(--text-muted); font-weight: normal;">(Drag to reorder)</span></label>
                    
                    <!-- Add New Status Change -->
                    <div class="add-status-change" style="display: flex; gap: 0.75rem; margin-bottom: 1rem; align-items: flex-end;">
                        <div style="flex: 1;">
                            <label style="font-size: 0.85rem; margin-bottom: 0.25rem; display: block;">Status:</label>
                            <select id="new-status-select" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 6px; background: var(--input-bg); color: var(--text-primary);">
                                <option value="saved">Saved</option>
                                <option value="applied">Applied</option>
                                <option value="resume_screening">Resume Screening</option>
                                <option value="interview">Interview</option>
                                <option value="offer">Offer</option>
                                <option value="rejected">Rejected</option>
                                <option value="withdrawn">Withdrawn</option>
                                <option value="ended">Ended</option>
                            </select>
                        </div>
                        <div style="flex: 1;">
                            <label style="font-size: 0.85rem; margin-bottom: 0.25rem; display: block;">Date & Time:</label>
                            <input type="datetime-local" id="new-status-date" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 6px; background: var(--input-bg); color: var(--text-primary);">
                        </div>
                        <button type="button" id="add-status-btn" style="padding: 0.5rem 1rem; background: #6366f1; color: white; border: none; border-radius: 6px; cursor: pointer; white-space: nowrap; font-weight: 500;">
                            <i class="fas fa-plus"></i> Add Status
                        </button>
                    </div>
                    
                    <div class="status-history-list" id="status-history-list">
                        <!-- History items will be dynamically added here -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancel-add-job">Cancel</button>
                    <button type="submit" class="btn-primary">Save Job</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirm delete status change modal -->
    <div class="modal" id="status-delete-confirm">
        <div class="modal-content status-confirm-card">
            <div class="modal-header">
                <h2>Delete Status Update?</h2>
                <button class="close-btn" id="close-status-delete-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin: 0; color: var(--text-secondary);">
                    This status change will be removed from the history for this job. This action cannot be undone.
                </p>
            </div>
            <div class="modal-actions" style="justify-content: flex-end; gap: 0.75rem;">
                <button type="button" class="btn-secondary" id="cancel-status-delete">Cancel</button>
                <button type="button" class="btn-danger" id="confirm-status-delete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Comment Modal -->
    <div class="modal" id="comment-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Comment</h2>
                <button class="close-btn" id="close-comment-modal">&times;</button>
            </div>
            <form id="comment-form">
                <div class="form-group">
                    <label for="comment-text">Comment</label>
                    <textarea id="comment-text" rows="4" placeholder="Add your notes about this application..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancel-comment">Cancel</button>
                    <button type="submit" class="btn-primary">Save Comment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal" id="import-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Import Jobs from CSV</h2>
                <button class="close-btn" id="close-import-modal">&times;</button>
            </div>
            <div class="import-content">
                <div class="file-upload-area" id="file-upload-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Click to upload CSV file</p>
                    <input type="file" id="csv-file" accept=".csv" style="display: none;">
                </div>
                <div class="import-info">
                    <h4>CSV Format:</h4>
                    <p>Title, Company, Location, Applied Date, Status, URL, Description, Notes</p>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancel-import">Cancel</button>
                    <button type="button" class="btn-primary" id="import-btn" disabled>Import Jobs</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Stop/Cancel Timer Modal -->
    <div class="modal" id="cancel-timer-modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>End Timer Early?</h2>
                <button class="close-btn" id="close-cancel-timer-modal">&times;</button>
            </div>
            <div class="modal-body" style="padding: 1.5rem;">
                <p style="margin-bottom: 1.5rem; color: #666;">Choose how you want to end this timer:</p>
                <div style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1.5rem;">
                    <div style="padding: 1rem; border: 2px solid #10b981; border-radius: 8px; background: #f0fdf4;">
                        <div style="font-weight: 600; color: #10b981; margin-bottom: 0.25rem;">
                            <i class="fas fa-stop-circle"></i> Stop Timer
                        </div>
                        <div style="font-size: 0.9rem; color: #666;">Save your progress and the time you've focused so far</div>
                    </div>
                    <div style="padding: 1rem; border: 2px solid #ef4444; border-radius: 8px; background: #fef2f2;">
                        <div style="font-weight: 600; color: #ef4444; margin-bottom: 0.25rem;">
                            <i class="fas fa-times-circle"></i> Cancel Timer
                        </div>
                        <div style="font-size: 0.9rem; color: #666;">Discard this session without saving any progress</div>
                    </div>
                </div>
                <div class="modal-actions" style="display: flex; gap: 1rem; justify-content: space-between;">
                    <button type="button" class="btn-secondary" id="cancel-timer-continue">Continue Timer</button>
                    <div style="display: flex; gap: 0.75rem;">
                        <button type="button" class="btn-primary" id="cancel-timer-yes" style="background: #ef4444;">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="button" class="btn-primary" id="stop-timer-yes" style="background: #10b981;">
                            <i class="fas fa-stop"></i> Stop & Save
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>
